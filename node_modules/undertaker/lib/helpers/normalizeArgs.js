'use strict';

var assert = require('assert');

var map = require('arr-map');
var flatten = require('arr-flatten');

//registry=>任务系统的注册表，args=>任务arguments
function normalizeArgs(registry, args) {
  //从注册表中取出当前任务的执行方法
  function getFunction(task) {
    // 如果task参数是方法直接返回，否则去注册表取
    if (typeof task === 'function') {
      return task;
    }

    var fn = registry.get(task);
    assert(fn, 'Task never defined: ' + task);
    return fn;
  }
  //数组扁平化
  var flattenArgs = flatten(args);
  assert(flattenArgs.length, 'One or more tasks should be combined using series or parallel');
  // 生成任务队列数组
  return map(flattenArgs, getFunction);
}

module.exports = normalizeArgs;
